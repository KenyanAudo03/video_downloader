{% extends 'base.html' %} {% load static %} {% block title %}{{ query }}
{% endblock %} {% block content %}
<link rel="stylesheet" href="{% static 'css/search/search_results.css' %}" />
<div class="video-app-container">
  {% if error %}
  <div class="error">{{ error }}</div>
  {% elif type == 'search' and results %}
  <!-- Split layout container -->
  <div class="split-layout" id="splitLayout" style="display: none">
    <div class="video-player-section">
      <div class="video-player-container">
        <span class="close-player" onclick="closeVideoPlayer()">Ã—</span>
        <iframe
          id="sideVideoFrame"
          allowfullscreen
          allow="autoplay; encrypted-media"
          frameborder="0"
        ></iframe>
      </div>
      <div class="current-video-info" id="currentVideoInfo">
        <h3 id="currentVideoTitle"></h3>
        <!-- Download button for currently playing video -->
        <button
          class="current-video-download-btn"
          id="currentVideoDownloadBtn"
          onclick="downloadCurrentVideo()"
        >
          <svg class="download-icon" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
          Download Video
        </button>
      </div>
    </div>
    <div class="video-list-section">
      <div class="searched-video-grid" id="sideVideoGrid">
        <!-- Videos will be populated here -->
      </div>
      <div
        class="loading-spinner"
        id="sideLoadingSpinner"
        style="display: none"
      >
        <div class="spinner"></div>
        <p>Loading more videos...</p>
      </div>
    </div>
  </div>

  <!-- Original grid layout -->
  <div class="original-layout" id="originalLayout">
    <div class="searched-video-grid" id="videoGrid">
      {% for video in results %}
      <div class="searched-video-card" data-video-id="{{ video.id }}">
        <div
          class="searched-video-thumbnail"
          onclick="openVideoPlayer('{{ video.id }}', '{{ video.title|escapejs }}')"
        >
          {% if video.thumbnails %}
          <img
            class="searched-thumbnail-img"
            src="{{ video.thumbnails.0.url }}"
            alt="{{ video.title }}"
            loading="lazy"
          />
          {% endif %} {% if video.duration %}
          <div class="searched-video-duration">{{ video.duration }}</div>
          {% endif %} {% if video.viewCount %}
          <div class="searched-video-views">{{ video.viewCount.short }}</div>
          {% endif %}

          <div class="searched-play-overlay">
            <div class="searched-play-icon"></div>
          </div>
        </div>

        <div class="searched-video-info">
          <h3 class="searched-video-title">{{ video.title }}</h3>
          <div class="searched-video-meta">
            <span>{{ video.channel.name }}</span>
            {% if video.publishedTime %}
            <span>{{ video.publishedTime }}</span>
            {% endif %}
          </div>
          <button
            class="download-btn"
            onclick="downloadVideo('{{ video.id }}', '{{ video.title|escapejs }}')"
          >
            <svg class="download-icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            Download
          </button>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
    <p>Loading more videos...</p>
  </div>
  {% endif %}
</div>

{% include 'search/search_results_js.html' %} {% endblock %}
